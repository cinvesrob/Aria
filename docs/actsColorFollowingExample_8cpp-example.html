<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Aria: actsColorFollowingExample.cpp</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Aria
   &#160;<span id="projectnumber">2.9.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('actsColorFollowingExample_8cpp-example.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">actsColorFollowingExample.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Connects to the ACTS program, and uses an <a class="el" href="classArAction.html" title="Base class for actions.">ArAction</a> subclass to drive the robot towards the largest detected blob.</p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &quot;Aria.h&quot;</span>



<span class="comment">// Chase is an action that moves the robot toward the largest blob that</span>
<span class="comment">// appears in it&#39;s current field of view.</span>
<span class="keyword">class </span>Chase : <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="classArAction.html" title="Base class for actions.">ArAction</a>
{
  
<span class="keyword">public</span>:
  
  <span class="comment">// The state of the chase action</span>
  <span class="keyword">enum</span> State {
    NO_TARGET,      <span class="comment">// There is no target in view</span>
    TARGET,         <span class="comment">// This is a target in view</span>
  };

  <span class="comment">// Constructor</span>
  Chase(<a name="_a1"></a><a class="code" href="classArACTS__1__2.html" title="Communicate with ACTS.">ArACTS_1_2</a> *acts, <a name="_a2"></a><a class="code" href="classArVCC4.html" title="Control the pan, tilt, and zoom mechanisms of the Canon VC-C4 and VC-C50i cameras.">ArVCC4</a> *camera);
  
  <span class="comment">// Destructor</span>
  ~Chase(<span class="keywordtype">void</span>);
  
  <span class="comment">// The action</span>
  <a name="_a3"></a><a class="code" href="classArActionDesired.html" title="Contains values returned by ArAction objects expressing desired motion commands to resolver...">ArActionDesired</a> *<a name="a4"></a><a class="code" href="classArAction.html#a900675ede8563489ccc2e7e0934670bb" title="Fires the action, returning what the action wants to do.">fire</a>(<a class="code" href="classArActionDesired.html" title="Contains values returned by ArAction objects expressing desired motion commands to resolver...">ArActionDesired</a> currentDesired);

  <span class="comment">// Set the ACTS channel that we want to get blob info from</span>
  <span class="keywordtype">bool</span> setChannel(<span class="keywordtype">int</span> channel);

  <span class="comment">// Return the current state of this action</span>
  State getState(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> myState; }

  <span class="comment">// Height and width of pixels from frame-grabber</span>
  <span class="keyword">enum</span> {
    WIDTH = 160,
    HEIGHT = 120
  };

<span class="keyword">protected</span>:
  <a class="code" href="classArActionDesired.html" title="Contains values returned by ArAction objects expressing desired motion commands to resolver...">ArActionDesired</a> myDesired;
  <a class="code" href="classArACTS__1__2.html" title="Communicate with ACTS.">ArACTS_1_2</a> *myActs;
  <a class="code" href="classArVCC4.html" title="Control the pan, tilt, and zoom mechanisms of the Canon VC-C4 and VC-C50i cameras.">ArVCC4</a> *myCamera;
  <a name="_a5"></a><a class="code" href="classArTime.html" title="A class for time readings and measuring durations.">ArTime</a> myLastSeen;
  State myState;
  <span class="keywordtype">int</span> myChannel;
  <span class="keywordtype">int</span> myMaxTime;
};


<span class="comment">// Constructor: Initialize the chase action</span>
Chase::Chase(<a class="code" href="classArACTS__1__2.html" title="Communicate with ACTS.">ArACTS_1_2</a> *acts, <a class="code" href="classArVCC4.html" title="Control the pan, tilt, and zoom mechanisms of the Canon VC-C4 and VC-C50i cameras.">ArVCC4</a> *camera) :
    <a class="code" href="classArAction.html" title="Base class for actions.">ArAction</a>(<span class="stringliteral">&quot;Chase&quot;</span>, <span class="stringliteral">&quot;Chases the largest blob.&quot;</span>)
{
  myActs = acts;
  myCamera = camera;
  myChannel = 0;
  myState = NO_TARGET;
  setChannel(1);
  myLastSeen.setToNow();
  myMaxTime = 1000;
}

<span class="comment">// Destructor</span>
Chase::~Chase(<span class="keywordtype">void</span>) {}


<span class="comment">// The chase action</span>
<a class="code" href="classArActionDesired.html" title="Contains values returned by ArAction objects expressing desired motion commands to resolver...">ArActionDesired</a> *<a class="code" href="classArAction.html#a900675ede8563489ccc2e7e0934670bb" title="Fires the action, returning what the action wants to do.">Chase::fire</a>(<a class="code" href="classArActionDesired.html" title="Contains values returned by ArAction objects expressing desired motion commands to resolver...">ArActionDesired</a> currentDesired)
{
  <a name="_a6"></a><a class="code" href="classArACTSBlob.html" title="A class for the acts blob.">ArACTSBlob</a> blob;
  <a class="code" href="classArACTSBlob.html" title="A class for the acts blob.">ArACTSBlob</a> largestBlob;

  <span class="keywordtype">bool</span> flag = <span class="keyword">false</span>;

  <span class="keywordtype">int</span> numberOfBlobs;
  <span class="keywordtype">int</span> blobArea = 10;

  <span class="keywordtype">double</span> xRel, yRel;

  <span class="comment">// Reset the desired action</span>
  myDesired.reset();
  
  numberOfBlobs = myActs-&gt;getNumBlobs(myChannel);

  <span class="comment">// If there are blobs to be seen, set the time to now</span>
  <span class="keywordflow">if</span>(numberOfBlobs != 0)
  {
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; numberOfBlobs; i++)
    {
      myActs-&gt;getBlob(myChannel, i + 1, &amp;blob);
      <span class="keywordflow">if</span>(blob.<a name="a7"></a><a class="code" href="classArACTSBlob.html#ae93d582aad025b14cb07da1c8f6fc254" title="Gets the number of pixels (area) covered by the blob.">getArea</a>() &gt; blobArea)
      {
        flag = <span class="keyword">true</span>;
        blobArea = blob.<a class="code" href="classArACTSBlob.html#ae93d582aad025b14cb07da1c8f6fc254" title="Gets the number of pixels (area) covered by the blob.">getArea</a>();
        largestBlob = blob;
      }
    }

    myLastSeen.setToNow();
  }

  <span class="comment">// If we have not seen a blob in a while...</span>
  <span class="keywordflow">if</span> (myLastSeen.mSecSince() &gt; myMaxTime)
  {
    <span class="keywordflow">if</span>(myState != NO_TARGET) <a name="a8"></a><a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a9"></a><a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;Target Lost&quot;</span>);
    myState = NO_TARGET;
  }
  <span class="keywordflow">else</span>
  {
    <span class="comment">// If we see a blob and haven&#39;t seen one before..</span>
    <span class="keywordflow">if</span>(myState != TARGET) {
      <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;Target Aquired&quot;</span>);
      <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;(Using channel %d with %d blobs)&quot;</span>, myChannel, numberOfBlobs);
    }
    myState = TARGET;
  }

  <span class="keywordflow">if</span>(myState == TARGET &amp;&amp; flag == <span class="keyword">true</span>)
  { 
    <span class="comment">// Determine where the largest blob&#39;s center of gravity</span>
    <span class="comment">// is relative to the center of the camera</span>
    xRel = (double)(largestBlob.<a name="a10"></a><a class="code" href="classArACTSBlob.html#a5f6eb283420c455186090bd339c63289" title="Gets the X Center of Gravity of the blob.">getXCG</a>() - WIDTH/2.0)  / (double)WIDTH;
    yRel = (double)(largestBlob.<a name="a11"></a><a class="code" href="classArACTSBlob.html#a713ba6721a03e97d7722db58c729e817" title="Gets the Y Center of Gravity of the blob.">getYCG</a>() - HEIGHT/2.0) / (double)HEIGHT;
      
    <span class="comment">// Tilt the camera toward the blob</span>
    <span class="keywordflow">if</span>(!(<a name="a12"></a><a class="code" href="classArMath.html#a82f8be1c5071b6c35106200c18ca7907" title="Finds the absolute value of a double.">ArMath::fabs</a>(yRel) &lt; .20))
    {
      <span class="keywordflow">if</span> (-yRel &gt; 0)
        myCamera-&gt;tiltRel(1);
      <span class="keywordflow">else</span>
        myCamera-&gt;tiltRel(-1);
    }

    <span class="comment">// Set the heading and velocity for the robot</span>
    <span class="keywordflow">if</span> (<a class="code" href="classArMath.html#a82f8be1c5071b6c35106200c18ca7907" title="Finds the absolute value of a double.">ArMath::fabs</a>(xRel) &lt; .10)
    {
      myDesired.setDeltaHeading(0);
    }
    <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span> (<a class="code" href="classArMath.html#a82f8be1c5071b6c35106200c18ca7907" title="Finds the absolute value of a double.">ArMath::fabs</a>(-xRel * 10) &lt;= 10)
        myDesired.setDeltaHeading(-xRel * 10);
      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (-xRel &gt; 0)
        myDesired.setDeltaHeading(10);
      <span class="keywordflow">else</span>
        myDesired.setDeltaHeading(-10);
     
    }

    myDesired.setVel(200);
    <span class="keywordflow">return</span> &amp;myDesired;    
  }

  <span class="comment">// If we have no target, then don&#39;t set any action and let lower priority</span>
  <span class="comment">// actions (e.g. stop) control the robot.</span>
  <span class="keywordflow">return</span> &amp;myDesired;
}

<span class="comment">// Set the channel that the blob info will be obtained from</span>
<span class="keywordtype">bool</span> Chase::setChannel(<span class="keywordtype">int</span> channel)
{
  <span class="keywordflow">if</span> (channel &gt;= 1 &amp;&amp; channel &lt;= <a name="a13"></a><a class="code" href="classArACTS__1__2.html#abd29db5baf1b65fcb73019f664adc996a75ffa2bd0d4e4952f00f77c5ed3ea4b7" title="Number of channels there are.">ArACTS_1_2::NUM_CHANNELS</a>)
  {
    myChannel = channel;
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
  }
  <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}




<span class="comment">// Callback to enable/disable the keyboard driving action</span>
<span class="keywordtype">void</span> toggleAction(<a class="code" href="classArAction.html" title="Base class for actions.">ArAction</a>* action)
{
  <span class="keywordflow">if</span>(action-&gt;<a name="a14"></a><a class="code" href="classArAction.html#a72db278f558206fdec03cbc15ac72104" title="Returns whether the action is active or not.">isActive</a>()) {
    action-&gt;<a name="a15"></a><a class="code" href="classArAction.html#aeca3135308234a8224643541090bea2b" title="Deactivate the action.">deactivate</a>();
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;%s action is now deactivated.&quot;</span>, action-&gt;<a name="a16"></a><a class="code" href="classArAction.html#a77fd754d342d7662090f462e27971e08" title="Gets the name of the action.">getName</a>());
  }
  <span class="keywordflow">else</span> {
    action-&gt;<a name="a17"></a><a class="code" href="classArAction.html#a758f6d649620747c5fa743d4f7a8b53e" title="Activate the action.">activate</a>();
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;%s action is now activated.&quot;</span>, action-&gt;<a class="code" href="classArAction.html#a77fd754d342d7662090f462e27971e08" title="Gets the name of the action.">getName</a>());
  }
}



<span class="comment">// Main function</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)
{
  <a name="a18"></a><a class="code" href="classAria.html#ad99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including adding OS sign...">Aria::init</a>();
  <a name="_a19"></a><a class="code" href="classArArgumentParser.html" title="Parse and store program command-line arguments for use by other ARIA classes.">ArArgumentParser</a> parser(&amp;argc, argv);
  parser.loadDefaultArguments();
  <a name="_a20"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;
  <a name="_a21"></a><a class="code" href="classArRobotConnector.html" title="Connect to robot or simulator based on program command line parameters.">ArRobotConnector</a> robotConnector(&amp;parser, &amp;robot);
  <a name="_a22"></a><a class="code" href="classArLaserConnector.html" title="Create laser interface objects (for any kind of laser supported by ARIA) and connect to lasers based ...">ArLaserConnector</a> laserConnector(&amp;parser, &amp;robot, &amp;robotConnector);

  <span class="comment">// Sonar for basic obstacle avoidance</span>
  <a name="_a23"></a><a class="code" href="classArSonarDevice.html" title="Keep track of recent sonar readings from a robot as an ArRangeDevice.">ArSonarDevice</a> sonar;

  <span class="comment">// The camera (Cannon VC-C4) PTZ control</span>
  <span class="comment">// TODO replace with ArPTZConnector for other camera types</span>
  <a class="code" href="classArVCC4.html" title="Control the pan, tilt, and zoom mechanisms of the Canon VC-C4 and VC-C50i cameras.">ArVCC4</a> vcc4 (&amp;robot);

  <span class="comment">// Connect to the robot, get some initial data from it such as type and name,</span>
  <span class="comment">// and then load parameter files for this robot.</span>
  <span class="keywordflow">if</span>(!robotConnector.connectRobot())
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a24"></a><a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">&quot;actsColorFollowingExample: Could not connect to the robot.&quot;</span>);
    <span class="keywordflow">if</span>(parser.checkHelpAndWarnUnparsed())
    {
        <span class="comment">// -help not given</span>
        <a name="a25"></a><a class="code" href="classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())">Aria::logOptions</a>();
        <a name="a26"></a><a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
    }
  }

  <span class="keywordflow">if</span> (!<a name="a27"></a><a class="code" href="classAria.html#a1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())">Aria::parseArgs</a>() || !parser.checkHelpAndWarnUnparsed())
  {
    <a class="code" href="classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())">Aria::logOptions</a>();
    <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
  }

  <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;actsColorFollowingExample: Connected to robot.&quot;</span>);

  robot.<a name="a28"></a><a class="code" href="classArRobot.html#a3c3d878cfd11a2ef91230005a83bfcaa" title="Starts the instance to do processing in its own new thread.">runAsync</a>(<span class="keyword">true</span>);

  <span class="comment">// Connect to laser(s) as defined in parameter files.</span>
  <span class="comment">// (Some flags are available as arguments to connectLasers() to control error behavior and to control which lasers are put in the list of lasers stored by ArRobot. See docs for details.)</span>
  <span class="keywordflow">if</span>(!laserConnector.connectLasers())
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">&quot;Warning: Could not connect to configured lasers. &quot;</span>);
  }

  <span class="comment">// A key handler to take input from keyboard</span>
  <a name="_a29"></a><a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a> keyHandler;
  <a name="a30"></a><a class="code" href="classAria.html#a9e5496a4ec2c379c8e18706922b57cc1" title="Sets the key handler, so that other classes can find it using getKeyHandler()">Aria::setKeyHandler</a>(&amp;keyHandler);

  <span class="comment">// ACTS, for tracking blobs of color</span>
  <a class="code" href="classArACTS__1__2.html" title="Communicate with ACTS.">ArACTS_1_2</a> acts;

  <span class="comment">// Robot motion limiter actions (if obstacles are detected by sonar or laser)</span>
  <a name="_a31"></a><a class="code" href="classArActionLimiterForwards.html" title="Action to limit the forwards motion of the robot based on range sensor readings.">ArActionLimiterForwards</a> limiter(<span class="stringliteral">&quot;speed limiter near&quot;</span>, 350, 800, 200);
  <a class="code" href="classArActionLimiterForwards.html" title="Action to limit the forwards motion of the robot based on range sensor readings.">ArActionLimiterForwards</a> limiterFar(<span class="stringliteral">&quot;speed limiter far&quot;</span>, 400, 1250, 300);
  <a name="_a32"></a><a class="code" href="classArActionLimiterBackwards.html" title="Action to limit the backwards motion of the robot based on range sensor readings.">ArActionLimiterBackwards</a> backwardsLimiter;
  <a name="_a33"></a><a class="code" href="classArActionConstantVelocity.html" title="Action for going straight at a constant velocity.">ArActionConstantVelocity</a> stop(<span class="stringliteral">&quot;stop&quot;</span>, 0);
  <span class="comment">//ArActionConstantVelocity backup(&quot;backup&quot;, -200);</span>
  

  <span class="comment">// The color following action, defined above</span>
  Chase chase(&amp;acts, &amp;vcc4);

  <span class="comment">// Keyboard teleoperation action</span>
  <a name="_a34"></a><a class="code" href="classArActionKeydrive.html" title="This action will use the keyboard arrow keys for input to drive the robot.">ArActionKeydrive</a> keydriveAction;

  <span class="comment">// Use the &quot;a&quot; key to activate/deactivate keydrive mode</span>
  keyHandler.<a name="a35"></a><a class="code" href="classArKeyHandler.html#ad5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">&#39;a&#39;</span>, <span class="keyword">new</span> <a name="_a36"></a><a class="code" href="classArGlobalFunctor1.html" title="Functor for a global function with 1 parameter.">ArGlobalFunctor1&lt;ArAction*&gt;</a>(&amp;toggleAction, &amp;keydriveAction));

  <span class="comment">// Let Aria know about the key handler</span>
  <a class="code" href="classAria.html#a9e5496a4ec2c379c8e18706922b57cc1" title="Sets the key handler, so that other classes can find it using getKeyHandler()">Aria::setKeyHandler</a>(&amp;keyHandler);

  <span class="comment">// Add the key handler to the robot</span>
  robot.<a name="a37"></a><a class="code" href="classArRobot.html#ab4ea516667d2358f35b435d97b616ab1" title="Attachs a key handler.">attachKeyHandler</a>(&amp;keyHandler);

  robot.<a name="a38"></a><a class="code" href="classArRobot.html#a5aecc7ac998c9a31b82fdb904efa8609" title="Lock the robot instance.">lock</a>();

  <span class="comment">// Add the sonar to the robot</span>
  robot.<a name="a39"></a><a class="code" href="classArRobot.html#a97d57b28549fdef851c00749a97cc776" title="Adds a rangeDevice to the robot&#39;s list of them, and set the ArRangeDevice object&#39;s robot pointer to t...">addRangeDevice</a>(&amp;sonar);

  <span class="comment">// Open a connection to ACTS</span>
  <span class="keywordflow">if</span>(!acts.<a name="a40"></a><a class="code" href="classArACTS__1__2.html#a5ce088ec894e3154910f0e5149668f80" title="Opens the connection to ACTS.">openPort</a>(&amp;robot)) 
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">&quot;Error: Could not connect to ACTS... exiting.&quot;</span>);
    keyHandler.<a name="a41"></a><a class="code" href="classArKeyHandler.html#ae75d46abeb802d1edac99400d387c404" title="Sets stdin back to its original settings, if its been restored it won&#39;t read anymore.">restore</a>();
    <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(2);
  }
  

  <span class="comment">// Initialize the camera</span>
  vcc4.init();

  <span class="comment">// Artificially keep the robot from going too fast</span>
  robot.<a name="a42"></a><a class="code" href="classArRobot.html#ad6a5d53606c9ba9c8c796f908e2fc1a1" title="Sets the robot&#39;s absolute maximum translational velocity.">setAbsoluteMaxTransVel</a>(400);

  <span class="comment">// Enable the motors</span>
  robot.<a name="a43"></a><a class="code" href="classArRobot.html#aceef80a6274fb34aafcc422e4b1778c1" title="Sends a command to the robot with an int for argument.">comInt</a>(<a name="a44"></a><a class="code" href="classArCommands.html#a9a31f904a95bbc31d8b33c6637100cc4aa8d799cced5def80525936119963aad4" title="int, enable (1) or disable (0) motors">ArCommands::ENABLE</a>, 1);
  
  <span class="comment">// Turn off the amigobot sounds</span>
  robot.<a class="code" href="classArRobot.html#aceef80a6274fb34aafcc422e4b1778c1" title="Sends a command to the robot with an int for argument.">comInt</a>(<a name="a45"></a><a class="code" href="classArCommands.html#a9a31f904a95bbc31d8b33c6637100cc4a7a256695b7937192e88c976d2fd106e5" title="int, AmigoBot (old H8 model) specific, enable(1) or diable(0) sound">ArCommands::SOUNDTOG</a>, 0);

  <span class="comment">// Add the actions to the robot in descending order of importance.</span>
  robot.<a name="a46"></a><a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limiter, 7);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limiterFar, 6);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;backwardsLimiter, 5);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;keydriveAction, 4);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;chase, 3);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;stop, 1);

  robot.<a name="a47"></a><a class="code" href="classArRobot.html#a403d9de010dc2b8d478cd0b14b2d9491" title="Unlock the robot instance.">unlock</a>();

  <span class="comment">// Start with keydrive action disabled. Use the &#39;a&#39; key to turn it on.</span>
  keydriveAction.<a name="a48"></a>deactivate();

  <span class="comment">// Run the robot processing cycle until the connection is lost</span>
  <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;Running. Train ACTS to detect a color to drive towards an object, or use &#39;a&#39; key to switch to keyboard driving mode.&quot;</span>);
  
  robot.<a name="a49"></a><a class="code" href="classArRobot.html#a95201be7c39b521983b51e6f5d9303e4" title="Suspend calling thread until the ArRobot run loop has exited.">waitForRunExit</a>();

  <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
  <span class="keywordflow">return</span> 0;
}

</pre></div> </div><!-- contents -->
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Tue Nov 4 2014 09:55:43 for Aria by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
