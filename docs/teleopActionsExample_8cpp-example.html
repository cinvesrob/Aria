<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Aria: teleopActionsExample.cpp</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Aria
   &#160;<span id="projectnumber">2.9.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('teleopActionsExample_8cpp-example.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">teleopActionsExample.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example using actions for safe teleoperation with keyboard or joystick. This example program creates several "limiting" actions (stop the robot from hitting detected obstacles), as well as Joydrive and Keydrive actions which request movement based on keys pressed or a joystick attached to the computer. The limiting actions are added at a higher priority than the teleoperation actions, so they prevent those actions from driving the robot if nearby obstacles are detected; otherwise, you can drive the robot using they joystick or keyboard.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;Aria.h&quot;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    <a name="a0"></a><a class="code" href="classAria.html#ad99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including adding OS sign...">Aria::init</a>();
    <a name="_a1"></a><a class="code" href="classArArgumentParser.html" title="Parse and store program command-line arguments for use by other ARIA classes.">ArArgumentParser</a> parser(&amp;argc, argv);
    parser.<a name="a2"></a><a class="code" href="classArArgumentParser.html#a501694b62a7f8b0c3cadd84aeafe1b35" title="Adds args from default files and environmental variables.">loadDefaultArguments</a>();
    <a name="_a3"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;
    <a name="_a4"></a><a class="code" href="classArRobotConnector.html" title="Connect to robot or simulator based on program command line parameters.">ArRobotConnector</a> robotConnector(&amp;parser, &amp;robot);
    <span class="keywordflow">if</span>(!robotConnector.<a name="a5"></a><a class="code" href="classArRobotConnector.html#ab192ac393d9cc1e5b61b1a82b08d085d" title="Sets up the robot then connects it.">connectRobot</a>())
    {
      <a name="a6"></a><a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a7"></a><a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">&quot;teleopActionsExample: Could not connect to the robot.&quot;</span>);
      <span class="keywordflow">if</span>(parser.<a name="a8"></a><a class="code" href="classArArgumentParser.html#ac3889cbdfa862031c51bf80e06954914" title="Checks for the help strings and warns about unparsed arguments.">checkHelpAndWarnUnparsed</a>())
      {
          <a name="a9"></a><a class="code" href="classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())">Aria::logOptions</a>();
          <a name="a10"></a><a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
      }
    }
    <span class="keywordflow">if</span> (!<a name="a11"></a><a class="code" href="classAria.html#a1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())">Aria::parseArgs</a>() || !parser.<a class="code" href="classArArgumentParser.html#ac3889cbdfa862031c51bf80e06954914" title="Checks for the help strings and warns about unparsed arguments.">checkHelpAndWarnUnparsed</a>())
    {
      <a class="code" href="classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())">Aria::logOptions</a>();
      <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
    }
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a12"></a><a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;teleopActionsExample: Connected.&quot;</span>);

  
  <span class="comment">// limiter for close obstacles</span>
  <a name="_a13"></a><a class="code" href="classArActionLimiterForwards.html" title="Action to limit the forwards motion of the robot based on range sensor readings.">ArActionLimiterForwards</a> limiter(<span class="stringliteral">&quot;speed limiter near&quot;</span>, 300, 600, 250);
  <span class="comment">// limiter for far away obstacles</span>
  <a class="code" href="classArActionLimiterForwards.html" title="Action to limit the forwards motion of the robot based on range sensor readings.">ArActionLimiterForwards</a> limiterFar(<span class="stringliteral">&quot;speed limiter far&quot;</span>, 300, 1100, 400);
  <span class="comment">// limiter that checks IR sensors (like Peoplebot has)</span>
  <a name="_a14"></a><a class="code" href="classArActionLimiterTableSensor.html" title="Action to limit speed (and stop) based on whether the &quot;table&quot;-sensors see anything.">ArActionLimiterTableSensor</a> tableLimiter;
  <span class="comment">// limiter so we don&#39;t bump things backwards</span>
  <a name="_a15"></a><a class="code" href="classArActionLimiterBackwards.html" title="Action to limit the backwards motion of the robot based on range sensor readings.">ArActionLimiterBackwards</a> backwardsLimiter;
  <span class="comment">// the joydrive action</span>
  <a name="_a16"></a><a class="code" href="classArActionJoydrive.html" title="This action will use the joystick for input to drive the robot.">ArActionJoydrive</a> joydriveAct;
  <span class="comment">// the keydrive action</span>
  <a name="_a17"></a><a class="code" href="classArActionKeydrive.html" title="This action will use the keyboard arrow keys for input to drive the robot.">ArActionKeydrive</a> keydriveAct;
  
  <span class="comment">// sonar device, used by the limiter actions.</span>
  <a name="_a18"></a><a class="code" href="classArSonarDevice.html" title="Keep track of recent sonar readings from a robot as an ArRangeDevice.">ArSonarDevice</a> sonar;



  printf(<span class="stringliteral">&quot;This program will allow you to use a joystick or keyboard to control the robot.\nYou can use the arrow keys to drive, and the spacebar to stop.\nFor joystick control press the trigger button and then drive.\nPress escape to exit.\n&quot;</span>);

  <span class="comment">// if we don&#39;t have a joystick, let &#39;em know</span>
  <span class="keywordflow">if</span> (!joydriveAct.<a name="a19"></a><a class="code" href="classArActionJoydrive.html#aadc5a4816e3c69bb0c7b57f72bbadde5" title="Whether the joystick is initalized or not.">joystickInited</a>())
    printf(<span class="stringliteral">&quot;Do not have a joystick, only the arrow keys on the keyboard will work.\n&quot;</span>);
  
  <span class="comment">// add the sonar to the robot</span>
  robot.<a name="a20"></a><a class="code" href="classArRobot.html#a97d57b28549fdef851c00749a97cc776" title="Adds a rangeDevice to the robot&#39;s list of them, and set the ArRangeDevice object&#39;s robot pointer to t...">addRangeDevice</a>(&amp;sonar);


  <span class="comment">// set the robots maximum velocity (sonar don&#39;t work at all well if you&#39;re</span>
  <span class="comment">// going faster)</span>
  robot.<a name="a21"></a><a class="code" href="classArRobot.html#ad6a5d53606c9ba9c8c796f908e2fc1a1" title="Sets the robot&#39;s absolute maximum translational velocity.">setAbsoluteMaxTransVel</a>(400);

  <span class="comment">// enable the motor</span>
  robot.<a name="a22"></a><a class="code" href="classArRobot.html#aa3657bebab0086dd14ed0c8c3f76dc8b" title="Enables the motors on the robot.">enableMotors</a>();

  <span class="comment">// Add the actions, with the limiters as highest priority, then the teleop.</span>
  <span class="comment">// actions.  This will keep the teleop. actions from being able to drive too </span>
  <span class="comment">// fast and hit something</span>
  robot.<a name="a23"></a><a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;tableLimiter, 100);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limiter, 95);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limiterFar, 90);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;backwardsLimiter, 85);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;joydriveAct, 50);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;keydriveAct, 45);

  <span class="comment">// Configure the joydrive action so it will let the lower priority actions</span>
  <span class="comment">// (i.e. keydriveAct) request motion if the joystick button is</span>
  <span class="comment">// not pressed.</span>
  joydriveAct.<a name="a24"></a><a class="code" href="classArActionJoydrive.html#a2d2e8053a6a49487c5dbeadcbcc44556" title="Set if we&#39;ll stop if no button is pressed, otherwise just do nothing.">setStopIfNoButtonPressed</a>(<span class="keyword">false</span>);

  
  <span class="comment">// run the robot, true means that the run will exit if connection lost</span>
  robot.<a name="a25"></a><a class="code" href="classArRobot.html#a3c1c3056633caf455c8265259f57f6d7" title="Starts the instance to do processing in this thread.">run</a>(<span class="keyword">true</span>);
  
  <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
}
</pre></div> </div><!-- contents -->
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Tue Nov 4 2014 09:55:43 for Aria by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
